/* Copyright (c) Fortanix, Inc.
|* This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of
|* the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/. */

@use '../../../styling/defs.scss' as bk;

/* https://css-tricks.com/books/greatest-css-tricks/scroll-shadows */
@define-mixin scroll-shadows {
  --bgRGB: 73, 89, 99;
  --bg: rgb(var(--bgRGB));
  --bgTrans: rgba(var(--bgRGB), 0);
  --shadow: rgba(41, 50, 56, 0.5);
  background:
    linear-gradient(var(--bg) 30%, var(--bgTrans)) center top, // Shadow Cover TOP
    linear-gradient(var(--bgTrans), var(--bg) 70%) center bottom, // Shadow Cover BOTTOM
    radial-gradient(farthest-side at 50% 0, var(--shadow), rgba(0, 0, 0, 0)) center top, // Shadow TOP
    radial-gradient(farthest-side at 50% 100%, var(--shadow), rgba(0, 0, 0, 0)) center bottom; // Shadow BOTTOM
  background-repeat: no-repeat;
  background-size: 100% 40px, 100% 40px, 100% 14px, 100% 14px;
  background-attachment: local, local, scroll, scroll;
}

@layer baklava.components {
  .bk-tooltip {
    @include bk.component-base(bk-tooltip);
    
    cursor: default;
    
    // overflow-y: auto;
    
    max-width: 30rem;
    max-height: 8lh; /* Show about 8 lines of text before scrolling */
    /* Alternatively: https://floating-ui.com/docs/misc#handling-large-content
    max-width: calc(100svw - var(--bk-sizing-2));
    max-height: calc(100svh - var(--bk-sizing-2));
    */
    
    padding: bk.$spacing-4;
    padding-bottom: bk.$spacing-7;
    border-radius: bk.$radius-s;
    background: bk.$theme-tooltip-background-default;
    border: 1px solid bk.$theme-tooltip-border-default;

    @include bk.text-layout;
    text-align: left;
    color: bk.$theme-tooltip-text-default;
    @include bk.font(bk.$font-family-body);
    font-size: 12px;

    &.bk-tooltip--size-small {
      width: 140px;
    }
    &.bk-tooltip--size-medium {
      width: 225px;
    }
    &.bk-tooltip--size-large {
      width: 345px;
    }

    --arrow-size: 7px;

    &.bk-tooltip--arrow:before {
      content: '';
      border-bottom: 1px solid bk.$theme-tooltip-border-default;
      border-right: 1px solid bk.$theme-tooltip-border-default;
      background-color: bk.$theme-tooltip-background-default;
      position: absolute;
      width: calc(2 * var(--arrow-size));
      height: calc(2 * var(--arrow-size));
    }
    &:is(.bk-tooltip--arrow-bottom, .bk-tooltip--arrow-top):before {
      left: calc(50% - var(--arrow-size));
    }
    &.bk-tooltip--arrow-bottom:before {
      bottom: calc(-1 * (calc(var(--arrow-size) + 1px)));
      transform: rotate(45deg);
    }
    &.bk-tooltip--arrow-top:before {
      top: calc(-1 * (calc(var(--arrow-size) + 1px)));
      transform: rotate(-135deg);
    }
    &:is(.bk-tooltip--arrow-left, .bk-tooltip--arrow-right):before {
      top: calc(50% - var(--arrow-size));
    }
    &.bk-tooltip--arrow-left:before {
      left: calc(-1 * (calc(var(--arrow-size) + 1px)));
      transform: rotate(135deg);
    }
    &.bk-tooltip--arrow-right:before {
      right: calc(-1 * (calc(var(--arrow-size) + 1px)));
      transform: rotate(-45deg);
    }

    .bk-tooltip--title {
      font-size: bk.$font-size-l;
      font-weight: bk.$font-weight-semibold;
    }

    .bk-tooltip--icon {
      font-size: 18px;
      margin-right: 10px;
    }

    .bk-tooltip--alert {
      color: bk.$theme-tooltip-text-error;
    }
  }
  
  @position-try --bk-tooltip-position-top {
    margin-top: var(--bk-layout-header-height); /* Compensate for layout header */
    margin-bottom: 6px;
    /* position-area: top; */
    bottom: anchor(top);
    justify-self: anchor-center;
  }
  @position-try --bk-tooltip-position-bottom {
    margin-top: 6px;
    /* position-area: bottom; */
    justify-self: anchor-center;
    top: anchor(bottom);
  }
  @position-try --bk-tooltip-position-left {
    justify-self: anchor-center;
    right: anchor(left);
  }
  @position-try --bk-tooltip-position-right {
    justify-self: anchor-center;
    left: anchor(right);
  }
  
  .bk-tooltip[popover] {
    inset: auto; /* Note: future versions of Chrome should have this by default */
    position: fixed;
    /*position-anchor: --anchor-1;*/ /* Needs to be set dynamically */
    
    position-try-fallbacks: --bk-tooltip-position-top, --bk-tooltip-position-bottom, --bk-tooltip-position-left, --bk-tooltip-position-right;
    
    filter: drop-shadow(4px 4px 4px rgba(50 50 50 / 30%));
    
    @media (prefers-reduced-motion: no-preference) {
      --transition-duration: 150ms;
      transition:
        display var(--transition-duration) allow-discrete,
        overlay var(--transition-duration) allow-discrete,
        opacity var(--transition-duration) ease-out,
        translate var(--transition-duration) ease-out;
        /* transform */ /* Note: don't animate `transform` with floating-ui, since it relies on it for positioning */
      opacity: 0;
      translate: 0 0.3rem;
    }
    
    &:popover-open {
      opacity: 1;
      translate: none;
      
      @starting-style {
        opacity: 0;
        translate: 0 0.3rem;
      }
    }
  }
}
