/* Copyright (c) Fortanix, Inc.
|* This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of
|* the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/. */

@use '../../../styling/defs.scss' as bk;


// Note: `$blur` should be in px, not rem (blur effect should be independent of any font size scaling)
@mixin dialog-backdrop($entry-dur: 200ms, $exit-dur: 180ms, $blur: 2px) {
  &::backdrop {
    transition-property: overlay, display, background-color, backdrop-filter;
    transition-timing-function: linear;
    transition-behavior: allow-discrete;
    
    // Open state styling
    background-color: light-dark(rgb(0 0 0 / 10%), rgb(0 0 0 / 20%));
    backdrop-filter: blur($blur) opacity(1);
    
    // Entry transition styling
    @media (prefers-reduced-motion: no-preference) { transition-duration: $entry-dur; }
    @starting-style {
      background-color: transparent;
      backdrop-filter: blur($blur) opacity(0);
    }
  }
  // Exit transition styling
  // Note: cannot nest the following inside `::backdrop`, since `:not()` needs to apply to the dialog not `::backdrop`
  &:not(:popover-open)::backdrop {
    @media (prefers-reduced-motion: no-preference) { transition-duration: $exit-dur; }
    background-color: transparent;
    backdrop-filter: blur($blur) opacity(0);
  }
}

@mixin dialog-backdrop-opaque($entry-dur: 200ms, $exit-dur: 180ms) {
  &::backdrop {
    transition-property: overlay, display, background-color;
    transition-timing-function: linear;
    transition-behavior: allow-discrete;
    
    // Open state styling
    background-color: bk.$theme-page-default;
    
    // Entry transition styling
    @media (prefers-reduced-motion: no-preference) { transition-duration: $entry-dur; }
    @starting-style {
      background-color: transparent;
    }
  }
  // Exit transition styling
  // Note: cannot nest the following inside `::backdrop`, since `:not()` needs to apply to the dialog not `::backdrop`
  &:not(:popover-open)::backdrop {
    @media (prefers-reduced-motion: no-preference) { transition-duration: $exit-dur; }
    background-color: transparent;
  }
}

@mixin dialog-fade-in($entry-dur: 200ms, $exit-dur: 180ms, $scale: 1) {
  transition-property: overlay, display, opacity, scale;
  transition-timing-function: ease-out;
  transition-behavior: allow-discrete;
  
  // Open state styling
  opacity: 1;
  scale: 1;
  
  // Entry transition styling
  @media (prefers-reduced-motion: no-preference) { transition-duration: $entry-dur; }
  @starting-style {
    opacity: 0;
    scale: $scale;
  }
  
  // Exit transition styling
  &:not(:popover-open) {
    @media (prefers-reduced-motion: no-preference) { transition-duration: $exit-dur; }
    transition-timing-function: ease-in;
    opacity: 0;
    scale: calc(1 - (($scale - 1) * 0.2)); // Multiply by 0.2 to make the scale out effect a bit more subtle
  }
}

@mixin dialog-slide-over($entry-dur: 200ms, $exit-dur: 180ms, $size: 0.8, $origin: right) {
  $dir: if($origin==right, 1, -1);
  
  transition-property: overlay, display, translate;
  transition-timing-function: ease-out;
  transition-behavior: allow-discrete;
  
  // Open state styling
  translate: 0;
  @if $origin == left {
    margin-inline-end: calc((1 - $size) * 100vi);
  } @else if $origin == right {
    margin-inline-start: calc((1 - $size) * 100vi);
  }
  
  // Entry transition styling
  @media (prefers-reduced-motion: no-preference) { transition-duration: $entry-dur; }
  @starting-style {
    translate: calc($dir * $size * 100vi) 0;
  }
  
  // Exit transition styling
  &:not(:popover-open) {
    @media (prefers-reduced-motion: no-preference) { transition-duration: $exit-dur; }
    transition-timing-function: ease-in;
    translate: calc($dir * $size * 100vi) 0;
  }
}

@layer baklava.components {
  .bk-dialog-overlay {
    @include bk.component-base(bk-dialog-overlay);
    
    &:not([open]) {
      display: flex;
    }
    
    &:popover-open {
      --bk-dialog-overlay-entry-dur: 200ms;
      --bk-dialog-overlay-exit-dur: 120ms;
      --bk-dialog-overlay-fade-scale: 1;
      
      // Basic positioning
      position: fixed;
      inset: 0;
      max-width: 100vi;
      max-height: 100vb;
      
      box-shadow: rgba(0 0 0 / 35%) 0 bk.rem-from-px(5) bk.rem-from-px(15) !important;
      
      &.bk-dialog-overlay--slide-over {
        @include dialog-slide-over;
      }
    }
  }
}
