/* Copyright (c) Fortanix, Inc.
|* This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of
|* the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/. */

@use '../../../styling/defs.scss' as bk;
@use '../../containers/Panel/Panel.module.scss' as Panel;

@layer baklava.components {
  .bk-dialog {
    @include bk.component-base(bk-dialog);
    @include Panel.panel; // Reuse styling from `Panel`
    
    --bk-dialog-background-color: var(--bk-panel-background-color);
    --bk-dialog-padding-block: #{bk.$spacing-8};
    --bk-dialog-padding-inline: #{bk.$spacing-8};
    
    // width: bk.rem-from-px(584); // FIXME
    // max-width: calc(100% - 6px - 2em);
    // height: fit-content;
    // min-height: 60%;
    // max-height: calc(100% - 6px - 2em);
    
    margin: 0;
    padding: 0; // Do not apply padding on the outermost container (do it on the lower level elements instead)
    
    //box-shadow: 0 8px 10px 1px rgba(0 0 0 / 14%), 0 3px 14px 2px rgba(0 0 0 / 12%), 0 5px 5px -3px rgba(0 0 0 / 3%);
    border-radius: bk.$radius-3;
    &.bk-dialog--flat {
      border: none;
      border-radius: 0;
    }
    
    display: flex;
    flex-direction: column;
    
    .bk-dialog__header {
      position: sticky;
      top: 0;
      z-index: 1;
      
      padding-block: var(--bk-dialog-padding-block) 0;
      padding-inline: var(--bk-dialog-padding-inline);
      
      background: var(--bk-dialog-background-color);
      
      --header-shadow-size: calc(var(--bk-sizing-1) / 2);
      //box-shadow: 0 var(--header-shadow-size) 0 0 rgba(0 0 0 / 12%);
      /* Clip everything except the bottom shadow (-1px for weird clipping behavior with scroll) */
      //clip-path: inset(-1px -1px calc(-1 * var(--header-shadow-size)) -1px);
      
      display: flex;
      flex-direction: row;
      align-items: baseline;
      
      .bk-dialog__action { --keep: ; }
      :nth-child(1 of .bk-dialog__action) { // FIXME: not getting parsed by lightningcss?
        margin-inline-start: auto;
      }
    }
    
    .bk-dialog__content {
      flex: 1; /* Make sure we cover all available space */
      
      margin-block: bk.$spacing-7 bk.$spacing-9;
      padding-inline: var(--bk-dialog-padding-inline);
    }
    
    .bk-dialog__actions {
      padding: var(--bk-dialog-inset);
      padding-top: 0;
      
      display: flex;
      flex-direction: row;
      gap: 0.8rem;
    }
    
    // State: focus
    @include bk.focus-outset;
  }
  
  // Default styling for when a dialog is used as a modal (through `dialog.showModal()`)
  .bk-dialog:modal {
    position: fixed;
    inset: 0;
    //place-self: center; // Doesn't have browser support yet, use `margin: auto` instead
    margin: auto;
    
    // https://css-tip.com/center-max-width
    //max-height: 95svh;
    //margin-inline: max(1rem, 50% - 100ch/2);
    
    
    // Ref: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog#animating_dialogs
    
    &:not([open]) {
      opacity: 0;
      scale: 0.98 0.98;
      transition:
        opacity 1ms ease-out,
        scale 1ms ease-out,
        overlay 1ms ease-out allow-discrete,
        display 1ms ease-out allow-discrete;
      transition-duration: 200ms; // Exit transition duration
    }
    
    display: flex;
    opacity: 1;
    scale: 1 1;
    transition-duration: 120ms; /* Enter transition duration */
    transition-timing-function: ease-in;
    
    @starting-style {
      opacity: 0;
      scale: 1.05 1.05;
    }
  }
  
  // Note: cannot nest anything inside a pseudo-elements like `::backdrop`
  .bk-dialog::backdrop {
    --bk-dialog-backdrop-transition-dur: 600ms;//200ms;
    background-color: rgb(0 0 0 / 0%);
    transition:
      display var(--bk-dialog-backdrop-transition-dur) allow-discrete,
      overlay var(--bk-dialog-backdrop-transition-dur) allow-discrete,
      background-color var(--bk-dialog-backdrop-transition-dur);
  }
  .bk-dialog:modal::backdrop {
    background-color: rgb(0 0 0 / 20%);
    backdrop-filter: blur(5px); // Should be in px, not rem (blur effect should be constant)
  }
  @starting-style {
    .bk-dialog:modal::backdrop {
      background-color: rgb(0 0 0 / 0%);
    }
  }
}
